<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <link rel="stylesheet" href="../public/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>
<body>
    <h1>
        Chat using socket.io
    </h1>

    <div id="chat" class="card text-center">
        <div id="mensagensChat">

        </div>
    </div>

    <!-- div para ficar tudo centralizado -->
    <div class="d-grid gap-2 col-6 mx-auto">
        <span type="button" class="btn btn-primary">
            Número de pessoas conectadas: <span class="badge text-bg-secondary" id="conectedUser">0</span>
        </span>

        <!-- div do input do usurname -->
        <div class="input-group flex-nowrap">
            <span class="input-group-text" id="addon-wrapping">@</span>
            <input type="text" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping" id="username" required>
        </div>
        <!-- input da mensagem -->
        <input type="text" id="msg" placeholder="Mensage" class="form-control" required> 

        <!-- botao -->
        <button onclick="sendData()" class="btn btn-success">Enviar</button>
        <button onclick="clearChat()" class="btn btn-danger">Limpar</button>
    </div>
</body>

<style>
    #chat{
        max-height: 300px;
        min-height: 300px;
        overflow-y: scroll;
    }
    h1 {
        text-align: center;
    }

    body {
        background-color: aliceblue;
    }
</style>


<!-- socket no frontend -- URL pega no google "socket cdn" -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>

<!-- js do bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous">
</script>









<script>
    const socket = io("http://localhost:8080")

    // escutando evento de desconexao
    socket.on("disconnect", (data) => {
        console.log("Desconectado ")
    });

    // mostrando contagem de usuários conectados na tela 
    socket.on("connectedUsersCount", (count) => {
        var numberConected = document.getElementById("conectedUser")
        numberConected.innerHTML = count
    });

    



    function sendData(){
        var msg = document.getElementById("msg").value
        var username = document.getElementById("username").value

        if(msg == '' || msg == undefined || username == '' || username == undefined){
            alert("Campo não preenchido corretamente")
        } else {
             // enviando mensagem
            socket.emit("msg", {msg, username})
        }
    };

    function clearChat(){
        // limpando o chat
        var chat = document.getElementById("mensagensChat")   
        chat.parentNode.removeChild(chat)

        // criando div de novo
        var chatFather = document.getElementById("chat")
        var newChat = document.createElement("div")
        // setando a id antiga
        newChat.setAttribute("id", "mensagensChat")

        // adicionando
        chatFather.append(newChat)
        
    }

    // mostrando mensagem na tela 
    socket.on("showImg", (data) => {
        var paragrafo = document.getElementById("mensagensChat")
        var p = document.createElement("p")
        p.innerHTML = `@${data.username}:  ${data.msg}`
        paragrafo.append(p)
    })

    // //  mostrando usuários que desconectaram
    // socket.on("desconectedUser", (id) => {
    //     var paragrafo = document.getElementById("mensagensChat")
    //     var p = document.createElement("p")
    //     p.style.color = "red"
    //     p.innerHTML = `O usuário de id ${id} desconectou da conversa` 
    //     paragrafo.append(p)
    // })
</script>
</html>